---
layout: post
title: MCDO Candidate Subscription Service
permalink: /MCDO/
---

Inline with the incoming election, we have created a web application hosted on Bluemix, which aids in the dissemination of news, issues, and information regarding the candidates to the citizens of the Philippines.

MCDO is a Candidate Subscription service which integrates the Twilio and PostgreSQL services. Its targeted users are the Public and Campaign Managers.

Public Users
The Public first go to the Web Application hosted by Bluemix. Then they register and choose which candidates they want to subscribe to. Subscribing to a candidate includes the user into a list of people who will be notified with news updates regarding the candidate whenever there is a news blast.

Campaign Managers
Campaign managers are registered and are certified to represent their corresponding candidates. They register on the web application and include which candidate they are managing. Through the web application, they have the ability to send information about their candidate to the public users who have subscribed to the candidate.

This application targets the candidates, campaign managers, and the voters. It enables a platform for the candidates and their campaign managers in order to update their audience with their current happenings e.g. campaign schedules, important press releases, and other messages. It also targets the voters because they get to follow the chosen candidates.

We believe that this will be an eficient way for voters to subscribe to their candidates because of the lack of good internet connection in the country. With this application, the voters would only need to use the system to register and subscribe to the candidates. After this, all updates will be sent through text message and not an internet connection.

Download MCDO Powerpoint Presentation [here](https://github.com/kurtcoder/twitterinsightsresources/blob/master/Insights-For-Twitter-Ley.pptx?raw=true)



In this tutorial you will deploy a MCDO: Candidate Subscription Web App in Bluemix.


#### Copy MCDO Sample application from Github
Copy the repository that contains the application that you will deploy.

1. Create the directory MCDOapp, then go to the created directory.

mkdir MCDOapp
cd MCDOapp


2. Clone the Github Repository with the MCDOapp from [https://github.com/kurtcoder/insights-for-twitter](https://github.com/kurtcoder/insights-for-twitter)

git clone https://github.com/ongj/Candidatesupdate

3. Go to the directory containing the project.

cd Folderlocation

<br>

#### Create the Web Application using Gradle and deploy it in Bluemix using the CF tool

1. Make sure you are in the project directory

1. Use gradle to solve library dependencies and create the web application.

gradle assemble

2. Login to your bluemix account to use the CF tool
 cf login -a https://api.ng.bluemix.net -s dev
	
3. Deploy  it to bluemix
cf push MCDOapp-<yourname> -m 512M -p build/libs/twil.war

4. Go to the [Bluemix] (https://console.ng.bluemix.net) Website and Login.

3. Go to the `Dashboard` Tab and click the widget of your application `MCDOapp-<yourname>`

4. Click `Add a Service or API`

5. In the Catalog page look for the `Insights for Twitter` service and click it.

6. Rename the Service name to `Insights for Twitter - <yourname>` . Select the `Free Plan` Option in the `Selected Plan` Dropdown.

7. Click `Create`

8.  When prompted to Restage Application, press `Restage`

You have successfully deployed your Insights for Twitter Application

#### Using the Application

1. On a new tab, access your new application using the url `http://insights-for-twitter-<yourname>.mybluemix.net`

2. The first operation that the web application can do is to count the number of tweets, given a keyword e.g. `#ibm` or `binay`


Input #ibm in the textfield of `Counting # of Tweets`. The results will look like this:

```
	 {"related":{"search":{"href":"https://cdeservice.mybluemix.net:443/api/v1/messages/search?q=%23ibm"}},"search":{"results":198618}} 
```

This output which is in `JSON` format, shows the url that we used to access the Insights for Twitter Service

```
	 {"related":{"search":{"href":"https://cdeservice.mybluemix.net:443/api/v1/messages/search?q=%23ibm"}}
```

As well as the results of the query, which was to count how many tweets included the keyword

```
"search":{"results":198618}} 
```

3. The next operation that the web application can do is to search for tweets using a keyword. e.g. `#Duterte` and specifiying how many tweets regarding the keyword you want to see `1`

4. For the first text field enter `#Duterte` , for the second text field enter `1`

	>This will search for tweets which include #Duterte in its content, and display only 1.

The Result for the Query will look like this

```
{"search":{"results":6799,"current":1},"tweets":[{"cde":{"author":{"gender":"unknown","parenthood":{"isParent":"unknown","evidence":""},"location":{"country":"","city":"","state":""},"maritalStatus":{"isMarried":"unknown","evidence":""}},"content":{"sentiment":{"evidence":[{"polarity":"NEGATIVE","sentimentTerm":"NOT trust"},{"polarity":"NEGATIVE","sentimentTerm":"puppet"}],"polarity":"NEGATIVE"}}},"message":{"postedTime":"2014-12-23T03:03:18.000Z","verb":"post","link":"http://twitter.com/ericarreza/statuses/547225910999384065","inReplyTo":{"link":"http://twitter.com/iAmMomiRhay/statuses/547154097283923968"},"generator":{"displayName":"Twitter Web Client","link":"http://twitter.com"},"body":"@iAmMomiRhay @inquirerdotnet I don't trust 2 those NPA & other leftist they're puppet to Commie China #duterte should execute them. ðŸ˜¡ðŸ˜¤","favoritesCount":0,"objectType":"activity","actor":{"summary":"Buy Baybayin.PH tshirt by clicking #baybayinph","image":"https://pbs.twimg.com/profile_images/511434104382844929/E6s8ZSX0_normal.jpeg","statusesCount":10121,"utcOffset":"-32400","languages":["en"],"preferredUsername":"ericarreza","displayName":"Baybayin Retro","postedTime":"2009-05-10T02:10:15.000Z","link":"http://www.twitter.com/ericarreza","verified":false,"friendsCount":2001,"twitterTimeZone":"Alaska","favoritesCount":4588,"listedCount":3,"objectType":"person","links":[{"rel":"me","href":"http://facebook.com/r1210designers"}],"location":{"displayName":"Pearl of The Orient Sea","objectType":"place"},"id":"id:twitter.com:38975279","followersCount":434},"provider":{"displayName":"Twitter","link":"http://www.twitter.com","objectType":"service"},"twitter_filter_level":"medium","twitter_entities":{"urls":[],"hashtags":[{"indices":[106,114],"text":"duterte"}],"user_mentions":[{"indices":[0,12],"screen_name":"iAmMomiRhay","id_str":"248089128","name":"rhay garcia","id":248089128},{"indices":[13,28],"screen_name":"inquirerdotnet","id_str":"15448383","name":"Inquirer Group","id":15448383}],"trends":[],"symbols":[]},"twitter_lang":"en","id":"tag:search.twitter.com,2005:547225910999384065","retweetCount":0,"gnip":{"language":{"value":"en"}},"object":{"summary":"@iAmMomiRhay @inquirerdotnet I don't trust 2 those NPA & other leftist they're puppet to Commie China #duterte should execute them. ðŸ˜¡ðŸ˜¤","postedTime":"2014-12-23T03:03:18.000Z","link":"http://twitter.com/ericarreza/statuses/547225910999384065","id":"object:search.twitter.com,2005:547225910999384065","objectType":"note"}}}],"related":{"next":{"href":"https://cdeservice.mybluemix.net:443/api/v1/messages/search?q=%23Duterte&from=1&size=1"}}}

```

This output which is in `JSON` format, shows information regarding the user who tweeted the tweet and information regarding the tweet

```
{"search":{"results":6799,"current":1},"tweets":[{"cde":{"author":{"gender":"unknown","parenthood":{"isParent":"unknown","evidence":""},"location":{"country":"","city":"","state":""},"maritalStatus":{"isMarried":"unknown","evidence":""}},"content":{"sentiment":{"evidence":[{"polarity":"NEGATIVE","sentimentTerm":"NOT trust"},{"polarity":"NEGATIVE","sentimentTerm":"puppet"}],"polarity":"NEGATIVE"}}},"message":{"postedTime":"2014-12-23T03:03:18.000Z","verb":"post","link":"http://twitter.com/ericarreza/statuses/547225910999384065","inReplyTo":{"link":"http://twitter.com/iAmMomiRhay/statuses/547154097283923968"},"generator":{"displayName":"Twitter Web Client","link":"http://twitter.com"},"body":"@iAmMomiRhay @inquirerdotnet I don't trust 2 those NPA & other leftist they're puppet to Commie China #duterte should execute them. ðŸ˜¡ðŸ˜¤","favoritesCount":0,"objectType":"activity","actor":{"summary":"Buy Baybayin.PH tshirt by clicking #baybayinph","image":"https://pbs.twimg.com/profile_images/511434104382844929/E6s8ZSX0_normal.jpeg","statusesCount":10121,"utcOffset":"-32400","languages":["en"],"preferredUsername":"ericarreza","displayName":"Baybayin Retro","postedTime":"2009-05-10T02:10:15.000Z","link":"http://www.twitter.com/ericarreza","verified":false,"friendsCount":2001,"twitterTimeZone":"Alaska","favoritesCount":4588,"listedCount":3,"objectType":"person","links":[{"rel":"me","href":"http://facebook.com/r1210designers"}],"location":{"displayName":"Pearl of The Orient Sea","objectType":"place"},"id":"id:twitter.com:38975279","followersCount":434},"provider":{"displayName":"Twitter","link":"http://www.twitter.com","objectType":"service"},"twitter_filter_level":"medium","twitter_entities":{"urls":[],"hashtags":[{"indices":[106,114],"text":"duterte"}],"user_mentions":[{"indices":[0,12],"screen_name":"iAmMomiRhay","id_str":"248089128","name":"rhay garcia","id":248089128},{"indices":[13,28],"screen_name":"inquirerdotnet","id_str":"15448383","name":"Inquirer Group","id":15448383}],"trends":[],"symbols":[]},"twitter_lang":"en","id":"tag:search.twitter.com,2005:547225910999384065","retweetCount":0,"gnip":{"language":{"value":"en"}},"object":{"summary":"@iAmMomiRhay @inquirerdotnet I don't trust 2 those NPA & other leftist they're puppet to Commie China #duterte should execute them. ðŸ˜¡ðŸ˜¤","postedTime":"2014-12-23T03:03:18.000Z","link":"http://twitter.com/ericarreza/statuses/547225910999384065","id":"object:search.twitter.com,2005:547225910999384065","objectType":"note"}}}],


```

The output also shows the url that we used to access the Insights for Twitter Service

```
"related":{"next":{"href":"https://cdeservice.mybluemix.net:443/api/v1/messages/search?q=%23Duterte&from=1&size=1"}}}


```

#### Analyzing how the Application Works

In this tutorial, we were able to create an Insights for Twitter application which uses the operations provided by the
Insights for Twitter service.

First, in order for the application to access the service it needs to use the credentials of the service. You must login using your service credentials. It will use the credentials listed for insights-for-twitter in VCAP_SERVICES which is seen in Bluemix

````
                    JSONObject creds = (JSONObject) service.get("credentials");
                    String username = (String) creds.get("username");
                    String password = (String) creds.get("password");
                    String host = (String) creds.get("host");
                    Long port = (Long) creds.get("port");
                    String url = (String) creds.get("url");

````

To access the Insights for Twitter service, we use Endpoint URLS

	>The url given by VCAP_SERVICES looks like this
	> "url": "https://f517f432-e185-41b5-a362-145612499823:3IavoFP6dV@cdeservice.mybluemix.net"

For the count operation, this is the URL we generate

````
		String input_query = (String) request.getParameter("tQuery");
		
		String urlstring = connector.getUrl() + "/api/v1/messages/count?q=" + URLEncoder.encode(input_query, "UTF-8");
````

`input_query` refers to the value you entered in the text field.

`URLEncoder.encode` is a function which allows symbols e.g. #, (space), $ to be converted into a format that can be transmitted over the internet

`/api/v1/messages/count?q=`will be appended to the url, it specifies that we will be using the `count` operation

For the search operation, this is the URL we generate

````
		String input_query = (String) request.getParameter("tQuery");
		String input_size = (String) request.getParameter("tSize");
		
		String urlstring = connector.getUrl() + "/api/v1/messages/search?q=" + URLEncoder.encode(input_query, "UTF-8") + "&size=" + input_size;

````

`input_query` and `size` are the parameters which you entered in the text field.

	>input_query refers to a keyword you want to search
	
	>size refers to how many tweets you want displayed

`URLEncoder.encode` is a function which allows symbols e.g. #, (space), $ to be converted into a format that can be transmitted over the internet

`/api/v1/messages/search?q=` will be appended to the url, it specifies that we will be using the `search` operation


To use the Insights for Twitter service, we need to authenticate ourselves

````
String userandpass = connector.getUsername() + ":" + connector.getPassword();
		
		String basicAuthorization = "Basic " + javax.xml.bind.DatatypeConverter.printBase64Binary(userandpass.getBytes());
		
		
		 URL finalurl = new URL(urlstring);
         URLConnection urlconnection = finalurl.openConnection();
 
         urlconnection.setRequestProperty ("Authorization", basicAuthorization);

````

In order to authenticate ourselves, we use Client side Basic access authentication

An example of how it looks like is this

	> Authorization: Basic QWxhZGRpbjpPcGVuU2VzYW1l

We do this by getting the username and password credentials in the VCAP Services and combining them together into one string seperated by a colon

```` String userandpass = connector.getUsername() + ":" + connector.getPassword(); ````
	
We then encoded this string using the RFC2045-MIME variant of Base64 and specify the authorization method, `Basic`

```` String basicAuthorization = "Basic " + javax.xml.bind.DatatypeConverter.printBase64Binary(userandpass.getBytes()); ````

Lastly, we request for access from the url which has the results of our query.


```` 
	URL finalurl = new URL(urlstring);
        URLConnection urlconnection = finalurl.openConnection();
 
        urlconnection.setRequestProperty ("Authorization", basicAuthorization);
	
````

####End of Tutorial

